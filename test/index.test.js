const { firestore } = require("firebase-admin");
const admin = require("firebase-admin");
const mocha = require("mocha");
const assert = require('assert');

// Create a blank Firestore database with open rules (test mode) and
// download the serviceAccountKey.json
const serviceAccount = require("../serviceAccountKey.json");
admin.initializeApp({ credential: admin.credential.cert(serviceAccount) });

describe("A failure in the @google-cloud/firestore SDK", () => {

  const msec = 1618923370000;
  const date = new Date(msec);

  it("has no issues when not specifying @google-cloud/firestore SDK version", async () => {
    const db = admin.firestore();
    for(let i = 0; i < 3; i++) {
      await db.collection("CollectionName").doc().set({ date })
    }
    const querySnapshot = await db
      .collection("CollectionName")
      .where("date", "==", date)
      .get();

    assert(querySnapshot.size === 3);
  });
});
